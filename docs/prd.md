# 매출 입력/조회 시스템 PRD (Product Requirements Document)

## 1. 제품 개요
이 시스템은 식당 매출 정보를 손쉽게 기록하고, 기록된 매출 데이터를 날짜별로 확인할 수 있는 "매출 입력 및 조회 웹 서비스"다.  
점주 또는 관리자는 매일 장부 대신 이 화면에 매출을 입력하고, 이후 특정 날짜 또는 기간의 매출 현황을 빠르게 확인/검증할 수 있다.

## 2. 목적
- 종이/엑셀 기반 기록의 누락/오입력/중복 입력을 줄인다.
- 사장이 "오늘 얼마 벌었는지", "이번 주/이번 달 흐름이 어떤지"를 빠르게 확인하게 한다.
- 월말 보고서/원가관리(발생주의 결산 등)의 매출 데이터 소스로 활용 가능한 구조를 만든다.

## 3. 주요 사용자
- 점주(매장 사장)
- 매장 관리자(사장이 권한 위임한 직원)
- (향후) 회계 담당자/세무 대리인 → 조회만 가능할 수도 있음

## 4. 범위(스코프)
이번 릴리스(1차 버전) 포함 기능:
1. 매출 입력
2. 매출 조회

스코프 아웃:
- 주간/월간 통계 그래프
- 다운로드(Excel 등)
- 매출 수정/삭제 이력 관리
- 복수 매장 비교 대시보드

---

## 5. 기능 요구사항

### 5.1 매출 입력 기능

#### 입력 필드
1. **매출 발생일자 (date)**
   - 기본값: 오늘 날짜 (클라이언트 로컬 기준)
   - 과거 날짜: 가능
   - 미래 날짜: 불가 (검증 필요)

2. **고객 수 (int)**
   - 0 이상의 정수
   - 필수 입력

3. **금액 (int, KRW)**
   - 0 이상의 정수
   - 필수 입력
   - 단위: 원

4. **메모 (string)**
   - 선택 입력
   - 예: "점심 단체 20명 예약", "배달 매출 포함", "행사"

#### 동작 요구사항
- [저장] 버튼 클릭 시 서버(Spring Boot)를 통해 DB(Supabase)에 매출 데이터 저장
- 저장 성공 시:
  - "저장되었습니다" 토스트/알림
  - 사용자는 같은 화면에 머무르며 추가 입력 가능
  - 날짜는 그대로 유지(같은 날 여러 건 입력 편의), 고객 수/금액/메모는 초기화 추천
- 저장 실패 시:
  - 에러 메시지 노출
  - 폼 값은 유지 (사용자가 다시 제출 가능하게)

#### 중복 입력 정책
- 동일한 날짜에 여러 건 입력 가능  
  (예: 점심/저녁 따로 기록, 이벤트 매출 따로 기록)
- 유일 키로 막지 않는다.

#### 권한
- 로그인된 사용자만 입력 가능
- 사용자의 Supabase Auth 토큰을 프론트가 백엔드(Spring Boot)에 전송
- Spring Boot는 토큰 검증 후, 해당 사용자가 가진 `store_id`로만 insert를 허용한다.

#### 밸리데이션
- 미래 날짜 입력 시: "미래 날짜는 기록할 수 없습니다." 에러
- 고객 수 / 금액 음수 입력 시: "0 이상의 숫자만 가능합니다."

---

### 5.2 매출 조회 기능

#### 조회 내용
- 특정 날짜(또는 오늘)의 매출 목록
- 해당 날짜의 합계:
  - 총 매출 금액
  - 총 고객 수

#### 화면 요소
- 날짜 선택 컨트롤러 (date picker)
- 요약 카드:
  - "총 매출 금액: {합계}원"
  - "총 고객 수: {합계}명"
- 리스트:
  - 매출 발생일자
  - 고객 수
  - 금액
  - 메모
  - 기록 시각(정렬용)

#### 동작 요구사항
- 기본 날짜: 오늘
- 날짜 변경 시 자동으로 재조회
- 정렬 기준: 매출 발생일자 내림차순 → 기록 시간 내림차순  
  (최근에 추가된 기록이 위로 온다)

#### 빈 상태(empty state)
- 선택한 날짜에 데이터가 없을 경우:
  - "기록된 매출이 없습니다"
  - "오늘 매출 입력하기" 버튼으로 `/sales/new`로 이동 가능

#### 권한
- 로그인된 사용자만 조회 가능
- 본인 매장의 데이터만 확인 가능

---

## 6. 비기능 요구사항

### 6.1 인증 / 보안
- 로그인: Supabase Auth
- 프론트엔드(Next.js)는 Supabase Auth 토큰을 보유
- API 호출 시 Authorization 헤더로 토큰 전달
- Spring Boot는 Supabase의 공개키로 JWT 서명 검증
- Spring Boot는 토큰 내 user_id/store_id를 기반으로 권한 체크
- 다른 매장의 데이터 조회/입력은 차단

### 6.2 가용성
- 모바일 웹(사장 핸드폰)에서도 사용 가능해야 한다.
- 느린 네트워크 상황에서도 입력 폼이 날아가지 않도록, 저장 실패 시에도 값 유지.

### 6.3 확장성
- 같은 테이블(sales_record)을 기반으로 차후:
  - 주간/월간 매출 집계
  - 원가율 분석 (매출 대비 식자재비)
  - 월말보고서(발생주의 기준 손익계산)에 매출 데이터로 활용

---

## 7. 성공 지표 (MVP)
- 점주가 하루에 최소 1건 이상 매출 데이터를 기록하는가?
- 같은 날 2건 이상(점심/저녁 등) 기록하는 빈도가 유지되는가? → 반복 입력 UX 적합성 지표
- 사후보정(지난 날짜 입력)이 실제로 발생하는가? → 과거 수정 요구가 있는지 파악

---

## 8. 기술 스택
- 프론트엔드: Next.js (Vercel에 배포)
- 백엔드: Spring Boot (AWS EC2에 배포)
- DB: Supabase (Postgres / Auth)
- 통신 방식:
  - 프론트 → Spring Boot (JWT 포함)
  - Spring Boot → Supabase (DB read/write)
